<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glucose vs Insulin Simulation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f5;
            margin: 0;
            padding: 20px;
            text-align: center;
        }
        canvas {
            background-color: white;
            border: 1px solid #ccc;
            margin: 20px auto;
            display: block;
        }
        .controls {
            margin: 20px;
        }
        button {
            padding: 10px 15px;
            margin: 0 5px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
        }
        .stat-box {
            background-color: white;
            padding: 10px 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <h1>Glucose vs Insulin Simulation</h1>
    <p>This simulation shows how insulin helps cells absorb glucose from the bloodstream.</p>
    
    <div class="stats">
        <div class="stat-box">
            <h3>Blood Glucose</h3>
            <p id="glucose-count">0</p>
        </div>
        <div class="stat-box">
            <h3>Insulin</h3>
            <p id="insulin-count">0</p>
        </div>
        <div class="stat-box">
            <h3>Cells Fed</h3>
            <p id="cells-fed">0</p>
        </div>
    </div>
    
    <canvas id="gameCanvas" width="700" height="500"></canvas>
    
    <div class="controls">
        <button id="addGlucose">Add Glucose</button>
        <button id="addInsulin">Add Insulin</button>
        <button id="reset">Reset</button>
    </div>
    
    <script>
        // Game elements
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const glucoseCount = document.getElementById('glucose-count');
        const insulinCount = document.getElementById('insulin-count');
        const cellsFed = document.getElementById('cells-fed');
        
        // Game state
        let glucose = [];
        let insulin = [];
        let cells = [];
        let fedCells = 0;
        
        // Colors
        const BG_COLOR = '#f0f0f5';
        const GLUCOSE_COLOR = '#ff6464';
        const INSULIN_COLOR = '#6464ff';
        const CELL_COLOR = '#64c864';
        const FED_CELL_COLOR = '#8cff8c';
        
        // Cell class
        class Cell {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.radius = 20;
                this.fed = false;
            }
            
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = this.fed ? FED_CELL_COLOR : CELL_COLOR;
                ctx.fill();
                ctx.strokeStyle = '#333';
                ctx.stroke();
            }
            
            feed() {
                if (!this.fed) {
                    this.fed = true;
                    fedCells++;
                    cellsFed.textContent = fedCells;
                }
            }
        }
        
        // Initialize cells
        function initCells() {
            cells = [];
            const rows = 4;
            const cols = 8;
            const padding = 50;
            const startX = (canvas.width - (cols * 70)) / 2 + 35;
            const startY = 100;
            
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    const x = startX + col * 70;
                    const y = startY + row * 80;
                    cells.push(new Cell(x, y));
                }
            }
        }
        
        // Add glucose
        function addGlucose() {
            const x = Math.random() * (canvas.width - 40) + 20;
            const y = Math.random() * (canvas.height - 40) + 20;
            glucose.push({ x, y, radius: 8, active: true });
            glucoseCount.textContent = glucose.length;
        }
        
        // Add insulin
        function addInsulin() {
            const x = Math.random() * (canvas.width - 40) + 20;
            const y = Math.random() * (canvas.height - 40) + 20;
            insulin.push({ x, y, radius: 8, active: true });
            insulinCount.textContent = insulin.length;
        }
        
        // Reset game
        function resetGame() {
            glucose = [];
            insulin = [];
            fedCells = 0;
            glucoseCount.textContent = '0';
            insulinCount.textContent = '0';
            cellsFed.textContent = '0';
            initCells();
        }
        
        // Update game state
        function update() {
            // Move glucose randomly
            glucose.forEach(g => {
                g.x += (Math.random() - 0.5) * 2;
                g.y += (Math.random() - 0.5) * 2;
                
                // Keep within bounds
                g.x = Math.max(g.radius, Math.min(canvas.width - g.radius, g.x));
                g.y = Math.max(g.radius, Math.min(canvas.height - g.radius, g.y));
            });
            
            // Move insulin toward glucose
            insulin.forEach(ins => {
                if (glucose.length > 0) {
                    // Find nearest glucose
                    let closest = null;
                    let minDist = Infinity;
                    
                    glucose.forEach(g => {
                        const dx = g.x - ins.x;
                        const dy = g.y - ins.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);
                        
                        if (dist < minDist) {
                            minDist = dist;
                            closest = g;
                        }
                    });
                    
                    // Move toward closest glucose
                    if (closest) {
                        const dx = closest.x - ins.x;
                        const dy = closest.y - ins.y;
                        const angle = Math.atan2(dy, dx);
                        const speed = 2;
                        
                        ins.x += Math.cos(angle) * speed;
                        ins.y += Math.sin(angle) * speed;
                    }
                } else {
                    // Random movement if no glucose
                    ins.x += (Math.random() - 0.5) * 2;
                    ins.y += (Math.random() - 0.5) * 2;
                }
                
                // Keep within bounds
                ins.x = Math.max(ins.radius, Math.min(canvas.width - ins.radius, ins.x));
                ins.y = Math.max(ins.radius, Math.min(canvas.height - ins.radius, ins.y));
            });
            
            // Check for insulin-glucose collisions
            for (let i = insulin.length - 1; i >= 0; i--) {
                const ins = insulin[i];
                let found = false;
                
                for (let j = glucose.length - 1; j >= 0; j--) {
                    const g = glucose[j];
                    const dx = g.x - ins.x;
                    const dy = g.y - ins.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    
                    if (dist < g.radius + ins.radius) {
                        // Collision detected - remove both
                        glucose.splice(j, 1);
                        insulin.splice(i, 1);
                        found = true;
                        
                        // Feed a random cell
                        if (cells.length > 0) {
                            const randomCell = cells[Math.floor(Math.random() * cells.length)];
                            randomCell.feed();
                        }
                        
                        break;
                    }
                }
                
                if (found) break;
            }
            
            // Update counts
            glucoseCount.textContent = glucose.length;
            insulinCount.textContent = insulin.length;
        }
        
        // Draw everything
        function draw() {
            // Clear canvas
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw cells
            cells.forEach(cell => cell.draw());
            
            // Draw glucose
            glucose.forEach(g => {
                ctx.beginPath();
                ctx.arc(g.x, g.y, g.radius, 0, Math.PI * 2);
                ctx.fillStyle = GLUCOSE_COLOR;
                ctx.fill();
            });
            
            // Draw insulin
            insulin.forEach(ins => {
                ctx.beginPath();
                ctx.arc(ins.x, ins.y, ins.radius, 0, Math.PI * 2);
                ctx.fillStyle = INSULIN_COLOR;
                ctx.fill();
            });
            
            // Draw legend
            ctx.fillStyle = 'black';
            ctx.font = '16px Arial';
            ctx.fillText('Cells', 30, 30);
            ctx.fillText('Glucose (sugar)', 30, 60);
            ctx.fillText('Insulin', 30, 90);
            
            // Draw color indicators
            ctx.fillStyle = CELL_COLOR;
            ctx.fillRect(100, 15, 20, 20);
            ctx.fillStyle = GLUCOSE_COLOR;
            ctx.fillRect(150, 45, 20, 20);
            ctx.fillStyle = INSULIN_COLOR;
            ctx.fillRect(80, 75, 20, 20);
        }
        
        // Game loop
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }
        
        // Event listeners
        document.getElementById('addGlucose').addEventListener('click', addGlucose);
        document.getElementById('addInsulin').addEventListener('click', addInsulin);
        document.getElementById('reset').addEventListener('click', resetGame);
        
        // Start game
        initCells();
        gameLoop();
    </script>
</body>
</html>
