<!DOCTYPE html>
<html>
<head>
    <title>Notcoin 2.0 Ultimate</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        /* === CORE STYLES WITH SCROLL FIX === */
        body {
            background: #121212;
            color: gold;
            text-align: center;
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            touch-action: manipulation;
            overflow-x: hidden;
            min-height: 100vh;
            user-select: none;
            background-image: radial-gradient(circle at center, #222222 0%, #000000 100%);
        }

        #game-container {
            max-width: 800px;
            margin: 0 auto;
            padding-bottom: 100px;
        }

        /* === COIN STYLES === */
        #coin {
            width: 250px;
            height: 250px;
            background: radial-gradient(circle at 30% 30%, #FFD700, #B8860B);
            border-radius: 50%;
            margin: 20px auto;
            cursor: pointer;
            box-shadow: 0 0 30px yellow, 0 0 60px rgba(255, 215, 0, 0.3);
            border: 5px solid goldenrod;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            font-weight: bold;
            color: rgba(0,0,0,0.5);
            transition: transform 0.1s, box-shadow 0.3s;
            position: relative;
            z-index: 10;
        }

        #coin:hover {
            box-shadow: 0 0 40px yellow, 0 0 80px rgba(255, 215, 0, 0.4);
        }

        /* === ANIMATED BUTTON STYLES === */
        .upgrade-btn {
            background: linear-gradient(145deg, #333333, #444444);
            color: gold;
            border: 2px solid gold;
            padding: 12px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            margin: 5px;
            position: relative;
            overflow: hidden;
        }

        .upgrade-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
            background: linear-gradient(145deg, #444444, #555555);
        }

        .upgrade-btn:active {
            transform: translateY(1px);
        }

        .upgrade-btn::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to bottom right,
                rgba(255, 215, 0, 0),
                rgba(255, 215, 0, 0.1),
                rgba(255, 215, 0, 0)
            );
            transform: rotate(30deg);
            transition: all 0.5s;
        }

        .upgrade-btn:hover::after {
            left: 100%;
        }

        /* === STATS DISPLAY === */
        #stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            background: rgba(0,0,0,0.5);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        /* === SCROLLABLE SECTIONS === */
        .scroll-section {
            max-height: 60vh;
            overflow-y: auto;
            padding: 15px;
            margin: 10px 0;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            border: 1px solid rgba(255, 215, 0, 0.2);
            scrollbar-width: thin;
            scrollbar-color: gold #121212;
        }

        .scroll-section::-webkit-scrollbar {
            width: 8px;
        }

        .scroll-section::-webkit-scrollbar-track {
            background: #121212;
            border-radius: 10px;
        }

        .scroll-section::-webkit-scrollbar-thumb {
            background-color: gold;
            border-radius: 10px;
        }

        /* === SPIN WHEEL IMPROVEMENTS === */
        #wheel-container {
            position: relative;
            width: 250px;
            height: 250px;
            margin: 20px auto;
        }

        #wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            border: 5px solid goldenrod;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            transition: transform 3s cubic-bezier(0.17, 0.67, 0.12, 0.99);
        }

        .wheel-section {
            position: absolute;
            width: 50%;
            height: 50%;
            transform-origin: bottom right;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px black;
        }

        #spin-center-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: red;
            color: white;
            border: none;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            z-index: 10;
        }

        #spin-center-btn:hover {
            background: darkred;
        }

        /* === LEADERBOARD IMPROVEMENTS === */
        #leaderboard {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 20px 0;
        }

        #leaderboard th {
            background: linear-gradient(to bottom, #333, #222);
            color: gold;
            padding: 12px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        #leaderboard tr:nth-child(even) {
            background: rgba(255, 215, 0, 0.1);
        }

        #leaderboard tr:hover {
            background: rgba(255, 215, 0, 0.2);
        }

        #leaderboard td {
            padding: 10px;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
        }

        .rank-1 {
            background: linear-gradient(to right, rgba(255, 215, 0, 0.3), rgba(255, 215, 0, 0.1)) !important;
            font-weight: bold;
        }

        .rank-1::before {
            content: "ðŸ‘‘";
            margin-right: 5px;
        }

        /* === REFERRAL SYSTEM === */
        #referral-section {
            background: rgba(0,0,0,0.5);
            padding: 15px;
            border-radius: 15px;
            margin: 20px 0;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        #referral-link {
            background: rgba(255, 215, 0, 0.1);
            padding: 10px;
            border-radius: 8px;
            word-break: break-all;
            margin: 10px 0;
            display: inline-block;
        }

        /* === PARTICLE EFFECTS === */
        .coin-particle {
            position: absolute;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 5;
            background: gold;
            animation: float-up 1s forwards;
        }

        @keyframes float-up {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) scale(0);
                opacity: 0;
            }
        }

        /* === AUTO-SCROLL TOGGLE === */
        #auto-scroll-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            border: 2px solid gold;
            color: gold;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 1000;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 10px rgba(255,215,0,0.5);
        }

        /* === RESPONSIVE DESIGN === */
        @media (max-width: 600px) {
            .upgrades {
                grid-template-columns: 1fr;
            }
            
            #coin {
                width: 200px;
                height: 200px;
            }
            
            .scroll-section {
                max-height: 50vh;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <h1 style="text-shadow: 0 0 10px gold;">NOTCOIN 2.0 ULTIMATE</h1>
        
        <div id="stats">
            <div>
                <h3>Coins: <span id="coins">0</span></h3>
            </div>
            <div>
                <h3>Multiplier: <span id="multiplier">1</span>x</h3>
            </div>
            <div>
                <h3>Prestige: <span id="prestige">0</span></h3>
            </div>
        </div>

        <div id="coin" onclick="tapCoin()">N2</div>

        <div class="scroll-section">
            <div class="upgrades">
                <button class="upgrade-btn" onclick="buyUpgrade('2x')">2x Multiplier (100 coins)</button>
                <button class="upgrade-btn" onclick="buyUpgrade('5x')">5x Multiplier (500 coins)</button>
                <button class="upgrade-btn" onclick="buyUpgrade('auto')">Auto-Clicker (1000 coins)</button>
                <button class="upgrade-btn" onclick="buyUpgrade('critical')">Critical Hits (300 coins)</button>
                <button class="upgrade-btn" onclick="buyUpgrade('streak')">Tap Streaks (200 coins)</button>
                <button class="upgrade-btn" onclick="buyUpgrade('prestige')">Prestige (10,000 coins)</button>
                <button class="upgrade-btn" onclick="startMinigame('spin')">Lucky Spin (FREE)</button>
                <button class="upgrade-btn" onclick="startMinigame('flip')">Coin Flip (100 coins)</button>
                <button class="upgrade-btn" onclick="showNFTGallery()">NFT Gallery</button>
                <button class="upgrade-btn" onclick="showLeaderboard()">Leaderboard</button>
                <button class="upgrade-btn" onclick="connectWallet()">Connect Wallet</button>
                <button class="upgrade-btn" onclick="startTimeWarp()">Time Warp (500 coins)</button>
            </div>

            <div id="referral-section">
                <h3>Referral Program</h3>
                <p>Earn 10% of what your referrals earn!</p>
                <p>Your referral link:</p>
                <div id="referral-link">Loading...</div>
                <p>Referrals: <span id="referral-count">0</span></p>
                <p>Earned from referrals: <span id="referral-earnings">0</span> coins</p>
            </div>

            <div id="bank-section">
                <h3>Bank Account</h3>
                <p>Interest: 5% daily</p>
                <p>Saved: <span id="bank-balance">0</span> coins</p>
                <input type="number" id="bank-amount" placeholder="Amount" style="width: 100px; padding: 5px; background: #333; color: gold; border: 1px solid gold; border-radius: 5px;">
                <button class="upgrade-btn" onclick="depositToBank()">Deposit</button>
                <button class="upgrade-btn" onclick="withdrawFromBank()">Withdraw</button>
            </div>
        </div>

        <div id="spin-game" class="minigame-container">
            <h2>LUCKY SPIN</h2>
            <div id="wheel-container">
                <div id="wheel"></div>
                <button id="spin-center-btn" onclick="spinWheel()">SPIN</button>
            </div>
            <button class="upgrade-btn" onclick="closeMinigame()">Close</button>
        </div>

        <div id="leaderboard" class="minigame-container">
            <h2>LEADERBOARD</h2>
            <div style="max-height: 60vh; overflow-y: auto;">
                <table style="width: 100%;">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Player</th>
                            <th>Coins</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboard-body">
                        <!-- Leaderboard entries will appear here -->
                    </tbody>
                </table>
            </div>
            <button class="upgrade-btn" onclick="closeMinigame()">Close</button>
        </div>
    </div>

    <div id="auto-scroll-toggle" title="Toggle Auto-Scroll" onclick="toggleAutoScroll()">
        <span id="scroll-icon">â‡³</span>
    </div>

    <audio id="tap-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-coin-win-notification-1992.mp3"></audio>
    <audio id="upgrade-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3"></audio>
    <audio id="spin-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3"></audio>
    <audio id="win-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3"></audio>

    <script>
        // =====================
        // ENHANCED GAME STATE
        // =====================
        let coins = parseInt(localStorage.getItem('coins')) || 0;
        let multiplier = parseInt(localStorage.getItem('multiplier')) || 1;
        let autoClicker = localStorage.getItem('autoClicker') === 'true';
        let criticalChance = parseInt(localStorage.getItem('criticalChance')) || 0;
        let tapStreak = 0;
        let maxTapStreak = 0;
        let prestigeLevel = parseInt(localStorage.getItem('prestigeLevel')) || 0;
        let bankBalance = parseInt(localStorage.getItem('bankBalance')) || 0;
        let lastInterestDate = localStorage.getItem('lastInterestDate') || '';
        let referrals = JSON.parse(localStorage.getItem('referrals')) || { count: 0, earnings: 0 };
        let userId = localStorage.getItem('userId') || generateUserId();
        let autoScrollEnabled = localStorage.getItem('autoScroll') !== 'false';
        let leaderboard = [];
        let wheelSpinning = false;

        // =====================
        // INITIALIZE GAME
        // =====================
        function initGame() {
            // Initialize UI
            coinsDisplay.textContent = coins;
            multiplierDisplay.textContent = multiplier;
            prestigeDisplay.textContent = prestigeLevel;
            bankBalanceDisplay.textContent = bankBalance;
            referralCount.textContent = referrals.count;
            referralEarnings.textContent = referrals.earnings;
            
            // Generate referral link
            referralLink.textContent = `${window.location.href.split('?')[0]}?ref=${userId}`;
            
            // Load auto-scroll setting
            updateAutoScrollUI();
            
            // Initialize wheel
            initWheel();
            
            // Load leaderboard
            loadLeaderboard();
            
            // Start auto-clicker if enabled
            if (autoClicker) {
                startAutoClicker();
            }
            
            // Apply prestige bonus
            if (prestigeLevel > 0) {
                multiplier *= (1 + prestigeLevel * 0.5);
                multiplierDisplay.textContent = multiplier;
            }
            
            // Check for daily bonus
            checkDailyBonus();
            
            // Check for referral on first load
            checkReferral();
        }

        // =====================
        // CORE GAMEPLAY WITH ANIMATIONS
        // =====================
        function tapCoin() {
            // Play sound
            tapSound.currentTime = 0;
            tapSound.play();
            
            // Calculate base coins with animation
            let earned = multiplier;
            let isCritical = false;
            
            // Critical hit chance
            if (criticalChance > 0 && Math.random() < (criticalChance / 100)) {
                earned *= 10;
                isCritical = true;
                showCriticalEffect();
            }
            
            // Add to streak
            tapStreak++;
            if (tapStreak > maxTapStreak) maxTapStreak = tapStreak;
            updateStreakBar();
            
            // Apply streak bonus every 10 taps
            if (tapStreak % 10 === 0) {
                earned *= 2;
                showStreakBonus();
            }
            
            // Time warp bonus
            if (timeWarpActive) {
                earned *= 3;
            }
            
            // Create coin particles
            createParticles(earned, isCritical);
            
            // Add coins with counting animation
            animateValue(coinsDisplay, coins, coins + earned, 500);
            coins += earned;
            
            // Save progress
            saveGame();
            
            // Check achievements
            checkAchievements();
        }

        function createParticles(amount, isCritical) {
            const particleCount = Math.min(20, Math.max(5, Math.floor(amount / 10)));
            const coinRect = coin.getBoundingClientRect();
            const centerX = coinRect.left + coinRect.width / 2;
            const centerY = coinRect.top + coinRect.height / 2;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'coin-particle';
                
                // Critical particles are bigger and red
                if (isCritical) {
                    particle.style.width = '25px';
                    particle.style.height = '25px';
                    particle.style.background = 'radial-gradient(circle, red, darkred)';
                }
                
                // Random position around the coin
                const angle = Math.random() * Math.PI * 2;
                const distance = 50 + Math.random() * 50;
                const startX = centerX + Math.cos(angle) * 30;
                const startY = centerY + Math.sin(angle) * 30;
                
                particle.style.left = startX + 'px';
                particle.style.top = startY + 'px';
                
                // Random end position
                const tx = (Math.random() - 0.5) * 200;
                const ty = -(50 + Math.random() * 150);
                particle.style.setProperty('--tx', tx + 'px');
                particle.style.setProperty('--ty', ty + 'px');
                
                // Add +amount to some particles
                if (i === 0) {
                    const value = document.createElement('div');
                    value.textContent = '+' + amount;
                    value.style.position = 'absolute';
                    value.style.color = isCritical ? 'red' : 'gold';
                    value.style.fontWeight = 'bold';
                    value.style.fontSize = isCritical ? '20px' : '16px';
                    value.style.textShadow = '1px 1px 2px black';
                    particle.appendChild(value);
                }
                
                document.body.appendChild(particle);
                
                // Remove particle after animation
                setTimeout(() => {
                    particle.remove();
                }, 1000);
            }
            
            // Coin tap animation
            animateCoinTap();
        }

        function animateCoinTap() {
            coin.style.transform = 'scale(0.9)';
            setTimeout(() => {
                coin.style.transform = 'scale(1)';
            }, 100);
        }

        // =====================
        // IMPROVED SPIN WHEEL
        // =====================
        function initWheel() {
            const wheel = document.getElementById('wheel');
            wheel.innerHTML = '';
            
            const prizes = [500, 600, 700, 800, 900, 1000, 1500, 2000];
            const colors = ['#FF5252', '#FF4081', '#E040FB', '#7C4DFF', '#536DFE', '#448AFF', '#40C4FF', '#18FFFF'];
            
            for (let i = 0; i < 8; i++) {
                const section = document.createElement('div');
                section.className = 'wheel-section';
                section.style.transform = `rotate(${i * 45}deg)`;
                section.style.backgroundColor = colors[i];
                section.textContent = prizes[i];
                wheel.appendChild(section);
            }
        }

        function spinWheel() {
            if (wheelSpinning) return;
            
            wheelSpinning = true;
            spinSound.currentTime = 0;
            spinSound.play();
            
            const wheel = document.getElementById('wheel');
            const spinDuration = 3000 + Math.random() * 2000;
            const rotations = 5 + Math.floor(Math.random() * 3);
            const prizeIndex = Math.floor(Math.random() * 8);
            const degrees = rotations * 360 + (prizeIndex * 45);
            
            wheel.style.transform = `rotate(${-degrees}deg)`;
            
            setTimeout(() => {
                const prizes = [500, 600, 700, 800, 900, 1000, 1500, 2000];
                const prize = prizes[prizeIndex];
                
                coins += prize;
                coinsDisplay.textContent = coins;
                
                winSound.currentTime = 0;
                winSound.play();
                
                showUpgradeEffect(`You won ${prize} coins!`);
                saveGame();
                
                wheelSpinning = false;
            }, spinDuration);
        }

        // =====================
        // REAL-TIME LEADERBOARD
        // =====================
        async function loadLeaderboard() {
            // In a real app, you would fetch this from a server
            // For demo, we'll simulate with random data plus the player
            leaderboard = [
                { id: 'user1', name: 'CryptoKing', coins: 125000, isYou: false },
                { id: 'user2', name: 'TapMaster', coins: 98000, isYou: false },
                { id: 'user3', name: 'NotcoinPro', coins: 87650, isYou: false },
                { id: userId, name: 'You', coins: coins, isYou: true }
            ].sort((a, b) => b.coins - a.cosins);
            
            updateLeaderboard();
        }

        function updateLeaderboard() {
            const tbody = document.getElementById('leaderboard-body');
            tbody.innerHTML = '';
            
            leaderboard.forEach((user, index) => {
                const row = document.createElement('tr');
                if (user.isYou) row.style.fontWeight = 'bold';
                if (index === 0) row.className = 'rank-1';
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${user.name}</td>
                    <td>${user.coins.toLocaleString()}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // =====================
        // REFERRAL SYSTEM
        // =====================
        function checkReferral() {
            const urlParams = new URLSearchParams(window.location.search);
            const refId = urlParams.get('ref');
            
            if (refId && refId !== userId) {
                // Give bonus to referrer (in a real app, this would be server-side)
                const refBonus = Math.floor(coins * 0.1);
                referrals.earnings += refBonus;
                referrals.count++;
                
                showUpgradeEffect(`Referral bonus: +${refBonus} coins!`);
                saveGame();
                
                // Remove ref from URL
                history.replaceState(null, null, window.location.pathname);
            }
        }

        function copyReferralLink() {
            navigator.clipboard.writeText(referralLink.textContent);
            showUpgradeEffect('Referral link copied!');
        }

        // =====================
        // AUTO-SCROLL FEATURE
        // =====================
        function toggleAutoScroll() {
            autoScrollEnabled = !autoScrollEnabled;
            localStorage.setItem('autoScroll', autoScrollEnabled);
            updateAutoScrollUI();
            
            if (autoScrollEnabled) {
                scrollToBottom();
            }
        }

        function updateAutoScrollUI() {
            const icon = document.getElementById('scroll-icon');
            icon.textContent = autoScrollEnabled ? 'â‡³' : 'â‡µ';
            icon.style.color = autoScrollEnabled ? 'gold' : '#888';
        }

        function scrollToBottom() {
            if (autoScrollEnabled) {
                window.scrollTo({
                    top: document.body.scrollHeight,
                    behavior: 'smooth'
                });
            }
        }

        // =====================
        // HELPER FUNCTIONS
        // =====================
        function animateValue(element, start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                element.textContent = Math.floor(progress * (end - start) + start);
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        function generateUserId() {
            return 'user_' + Math.random().toString(36).substr(2, 9);
        }

        // =====================
        // INITIALIZE GAME
        // =====================
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
